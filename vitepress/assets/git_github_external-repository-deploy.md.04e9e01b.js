import{_ as s,o as n,c as a,V as l}from"./chunks/framework.716eacd7.js";const p="/vitepress/assets/deploy-keys.08a9f6cc.png",e="/vitepress/assets/secrets-actions.888a3a8d.png",A=JSON.parse('{"title":"跨仓库部署","description":"","frontmatter":{},"headers":[],"relativePath":"git/github/external-repository-deploy.md","lastUpdated":1683252450000}'),o={name:"git/github/external-repository-deploy.md"},c=l('<h1 id="跨仓库部署" tabindex="-1">跨仓库部署 <a class="header-anchor" href="#跨仓库部署" aria-label="Permalink to &quot;跨仓库部署&quot;">​</a></h1><blockquote><p>从 Github 的 A 仓库构建完成之后，将构建产物部署到 B 仓库上</p></blockquote><h3 id="使用-peaceiris-actions-gh-pages-v3-以及-deploy-key-进行部署" tabindex="-1">使用 <a href="https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-create-ssh-deploy-key" target="_blank" rel="noreferrer">peaceiris/actions-gh-pages@v3</a> 以及 <code>deploy_key</code> 进行部署 <a class="header-anchor" href="#使用-peaceiris-actions-gh-pages-v3-以及-deploy-key-进行部署" aria-label="Permalink to &quot;使用 [peaceiris/actions-gh-pages@v3](https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-create-ssh-deploy-key) 以及 `deploy_key` 进行部署&quot;">​</a></h3><ol><li>生成 ssh <strong>公钥</strong> 和 <strong>私钥</strong></li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">ssh-keygen </span><span style="color:#D19A66;">-t</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ed25519</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-C</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&lt;email&gt;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>将 <strong>&lt;email&gt;</strong> 替换为需要生成 <code>ssh</code> 的邮箱</p></div><ol start="2"><li>进入 B 仓库设置，进入目录 <code>Settings &gt; Deploy Keys(Security)</code>，点击 <code>Add deploy key</code>，填入任意 <code>Title</code> 以及第一步中生成的 <strong>公钥</strong>，并勾选 <code>Allow write access</code></li></ol><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>如果第一步没有修改文件名，应该是名称为 <strong>id_ed25519.pub</strong> 的文件 <img src="'+p+'" alt="deploy-keys"></p></div><ol start="3"><li>进入 A 仓库，进入目录 <code>Settings &gt; Secrets and variables &gt; Actions</code>，在 <code>Secrets</code> 的 tab 下点击 <code>New repository secret</code>，填入任意 <code>Name</code> (<em>在后续会使用到这个 Name，建议可以设置为比如 <code>ACTIONS_DEPLOY_KEY</code></em>)，在 <code>Secrets</code> 填入第一步中生成的 <strong>私钥</strong></li></ol><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>如果第一步中没有修改名，应该是名称为 <strong>id_ed25519</strong> 的文件 <img src="'+e+`" alt="secrets-actions"></p></div><ol start="4"><li>新增 A 仓库的 <code>.github/workflows/deploy.yml</code> (<em>文件名可任意</em>) 文件，并添加下面内容</li></ol><div class="language-yml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Deploy Docs</span></span>
<span class="line"><span style="color:#D19A66;">on</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">workflow_dispatch</span><span style="color:#ABB2BF;">: {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># master 发生 push 时触发部署</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">push</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">branches</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#98C379;">master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">jobs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">build-and-deploy</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Start Deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 指定运行机器</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">runs-on</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 执行步骤</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">steps</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 检出仓库</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">fetch-depth</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 安装 Node.js</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/setup-node@v3</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">node-version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;16.19.0&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">cache</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">npm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 安装依赖</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Install dependencies</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">npm ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 构建文档</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Build</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">npm run docs:build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 部署到 GitHub Pages</span></span>
<span class="line"><span style="color:#ABB2BF;">            - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Deploy to GitHub Pages</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">deploy_key</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ secrets.ACTIONS_DEPLOY_KEY }}</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 第 3 步中填写的 Name</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">publish_dir</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">./docs/.vitepress/dist</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 需要从 A 仓库中发布到 B 仓库的打包产物</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">external_repository</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">lin52025iq/lin52025iq.github.io</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># B 仓库的地址</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#E06C75;">publish_branch</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">gh-pages</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 发布到 B 仓库的分支</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div>`,12),t=[c];function r(i,B,y,b,d,u){return n(),a("div",null,t)}const F=s(o,[["render",r]]);export{A as __pageData,F as default};
